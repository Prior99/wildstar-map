<!DOCTYPE HTML>
<html>
	<head>
		<script src="lib/jquery.js"></script>
		<script src="js/graphics.js"></script>
		<script src="js/mouse.js"></script>
		<script src="js/index.js"></script>
		<script src="js/context.js"></script>
		<script src="js/create_place.js"></script>
		<script src="js/websocket.js"></script>
		<script src="js/connection.js"></script>
		<script src="js/drawables/cursor.js"></script>
		<script src="js/drawables/zoomometer.js"></script>
		<script src="js/drawables/fps.js"></script>
		<script src="port.js"></script>
		<style>
			* {
				font-family: "Verdana";
			}
			html, body {
				padding: 0;
				margin: 0;
				width: 100%;
				height: 100%;
			}
			canvas {
				position: absolute;
				left: 0px;
				top: 0px;
				display: block;
				cursor: none;
			}
			canvas#map {
				background-color: #2f76bb;
				z-index: 10;
			}
			canvas#overlay {
				background-color: transparent;
				z-index: 20;
			}
			#wrapper {
				padding: 30px;
			}
			div.context {
				width: 200px;
				border: black;
				background-color: white;
				position: absolute;
				min-height: 20px;
				padding: 0;
				z-index: 90;
			}
			div.context a {
				width: 190px;
				display: inline-block;
				height: 20px;
				background-color: white;
				padding: 5px;
			}
			div.context a:hover {
				background-color: lightblue;
			}
			div.dialog {
				width: 600px;
				min-height: 100px;
				margin: auto;
				background-color: white;
				border: 1px solid black;
				z-index: 100;
				padding: 10px;
			}
			div.dialogwrapper {
				z-index: 99;
				width: 100%;
				margin: 0;
				padding: 0;
				margin-top: 100px;
				position: absolute;
			}
		</style>
	</head>
	<body>
		<div id="wrapper">
		</div>
		</canvas>
		<script>
			function ShowMap(map) {
				$.ajax({
					url : map + "/descriptor.json",
					success : function(obj) {
						$("body").html("");
						var canvas = $("<canvas id='map'></canvas>").appendTo("body")[0];
						var overlaycanvas = $("<canvas id='overlay'></canvas>").appendTo("body")[0];
						var mouse = new Mouse(overlaycanvas);
						var graphics = new Graphics(canvas, overlaycanvas, obj, mouse, map);
						graphics.addDrawable(new Cursor(mouse));
						graphics.addDrawable(new Zoomometer(graphics, {
							x : 30,
							y : 100
						}));
						graphics.addDrawable(new FPS(graphics, {
							x : 30,
							y : 30
						}));
						var context = new Context(mouse);
						context.addEntry("Add Place", function() {
							createPlace(context.position.x, context.position.y, map);
						});
						context.addEntry("Log", function() {
							console.log("hi");
						});
					}
				});
			}

			$(function() {
				var wrapper = $("#wrapper");
				wrapper.append("<h1>Loading...</h1>");
				wrapper.append("<p>Waiting for connection to server...</p>");
				Connection.addLoginDoneHandler(function() {
					console.log("Login done. Identity is " + Connection.identity);
					wrapper.html("");
					wrapper.append("<h1>Select Map</h1>");
					Index($("<ul></ul>").appendTo(wrapper));
				});
				Connection.init();
				Websocket.init();
			});
		</script>
	</body>
</html>
